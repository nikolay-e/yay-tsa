services:
  # Development service - Vite dev server with hot reload
  dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    environment:
      - VITE_YAYTSA_SERVER_URL=${YAYTSA_SERVER_URL}
      - VITE_YAYTSA_CLIENT_NAME=${YAYTSA_CLIENT_NAME:-Yaytsa}
      - VITE_YAYTSA_DEVICE_NAME=${YAYTSA_DEVICE_NAME:-Docker Dev}
    ports:
      - '5173:5173'
    volumes:
      # Mount source directories for hot reload
      - ./packages/core/src:/app/packages/core/src
      - ./packages/platform/src:/app/packages/platform/src
      - ./packages/web/src:/app/packages/web/src
      - ./packages/web/static:/app/packages/web/static
      # Preserve node_modules and dist directories in container
      - /app/node_modules
      - /app/packages/core/node_modules
      - /app/packages/platform/node_modules
      - /app/packages/web/node_modules
      - /app/packages/core/dist
      - /app/packages/platform/dist
    working_dir: /app
    command: npm run dev
    profiles:
      - dev

  # Production service - Nginx with runtime config injection
  web:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    environment:
      - YAYTSA_SERVER_URL=${YAYTSA_SERVER_URL}
      - YAYTSA_CLIENT_NAME=${YAYTSA_CLIENT_NAME:-Yaytsa}
      - YAYTSA_DEVICE_NAME=${YAYTSA_DEVICE_NAME:-Docker Web}
    ports:
      - '8080:80'
    profiles:
      - production
